// Use DBML to define your database structure
// Docs: https://dbml.dbdiagram.io/docs

//**** SoundScape ****
Table user_account {
  id integer [primary key]
  email varchar [unique, not null]
  password varchar [not null] 
  password_token varchar  
}

Table user_details {  
  user_id integer [primary key, not null]
  first_name varchar [not null]
  last_name varchar [not null] 
  age integer [not null, note: 'CHECK (age >= 13 AND age <= 120)']
  phone_no varchar [unique]
  created_at timestamp
  updated_at timestamp
}

Table festival_edition { //retinem date ce difere anul pt festival
  id integer [primary key]   
  festival_id integer 
  year_happened integer [not null] 
  venue_name varchar [not null]
  description varchar [not null]
  status enum [not null, note: 'published, ongoing, ended, cancelled']
  start_date date [not null]
  end_date date [not null]
  people_capacity integer [not null, note: 'CHECK (people_capacity > 0)']
  terms_conditions text [not null]
  updated_at timestamp [not null]

  indexes {
    (festival_id, year_happened) [unique] // Ensures unique edition per date for each festival
  }
}

Table festival {
  id integer [primary key]
  name varchar [not null]
  country varchar [not null] 
  city varchar [not null] 
  street_name varchar [not null]
  street_no integer [not null]
  festival_contact varchar [not null]
  website varchar 
  logo_url varchar 
  updated_at timestamp [not null]
}

Table edition_review {
  id integer [primary key]
  edition_id integer [not null]
  user_id integer 
  rating_stars integer [not null, note: 'CHECK (rating_stars >= 1 AND rating_stars <= 5)'] 
  comment text [not null]
  posted_at timestamp [not null] //update with now date

  indexes {
    (edition_id, user_id) [unique] //one reviews per user for that specific edition
  }
}

Table artist {
  id integer [primary key]
  real_name varchar [unique, not null] 
  stage_name varchar [unique, not null]
  music_genre varchar [not null]
  instagram_account varchar [not null] 
  image_url varchar [not null]
  manager_email varchar
}

Table edition_artist {
  id integer [primary key]

  edition_id integer [not null]
  artist_id integer [not null]
  is_headliner boolean [default: false]
  performance_date date [not null]
  start_time time [not null]
  end_time time [not null]
}

Table ticket_type {
  id integer [primary key]
  name enum [not null, note: 'VIP, Regular, EarlyBird, Parent, Elderly, Couple']
  benefits text
  price decimal(10, 2) [not null]
}

Table purchase {
  id integer [primary key]
  user_id integer   [not null]
  edition_id integer [not null] 
  quantity integer [not null] 
  ticket_type_id integer [not null] 
  purchase_date timestamp [not null]
} 


// Relationships
Ref: user_account.id - user_details.user_id [delete: cascade]
Ref: user_account.id < purchase.user_id
Ref: user_account.id < edition_review.user_id [delete: cascade]

Ref: festival.id < festival_edition.festival_id [delete: cascade]


Ref: festival_edition.id < purchase.edition_id 
Ref: festival_edition.id < edition_review.edition_id [delete: cascade]
Ref: festival_edition.id < edition_artist.edition_id [delete: cascade]

Ref: artist.id < edition_artist.artist_id [delete: cascade]


Ref: ticket_type.id < purchase.ticket_type_id

